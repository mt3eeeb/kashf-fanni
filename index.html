<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>نموذج كشف زراعي</title>
<style>
body{font-family:tahoma;background:#f5f5f5;margin:0}
.section{background:#2ecc71;color:#fff;padding:8px;font-weight:bold}
.box{background:#fff;padding:10px;margin-bottom:10px}
.row{display:flex;gap:6px;margin-bottom:6px}
input,select,button{padding:6px;border:1px solid #ccc;border-radius:4px;width:100%}
.btn-add{background:#3498db;color:#fff}
.btn-del{background:#e74c3c;color:#fff;width:50px}
.result{font-weight:bold;margin-top:6px}
.hidden{display:none}
</style>
</head>

<body>

<!-- 1-2-3 موجودة ولا نغيرها -->
<div class="section">1️⃣ البيانات العامة</div>
<div class="box"><input placeholder="اسم العميل"></div>

<div class="section">2️⃣ إحداثيات السجل</div>
<div class="box">
  <div class="row">
    <input placeholder="Longitude">
    <input placeholder="Latitude">
  </div>
</div>

<div class="section">3️⃣ إحداثية البوابة</div>
<div class="box">
  <div class="row">
    <input id="gateLng" placeholder="Longitude">
    <input id="gateLat" placeholder="Latitude">
  </div>
</div>

<!-- 4 زوايا المزرعة -->
<div class="section">4️⃣ زوايا المزرعة</div>
<div class="box">
  <div id="points"></div>
  <button class="btn-add" onclick="addPoint()">+ إضافة زاوية</button>
  <button onclick="calcArea()">حساب</button>
  <div id="areaResult" class="result"></div>
</div>

<!-- 5 الآبار -->
<div class="section">5️⃣ الآبار</div>
<div class="box">
  <div id="wells"></div>
  <button class="btn-add" onclick="addWell()">+ إضافة بئر</button>
</div>

<!-- 6 نظام الري -->
<div class="section">6️⃣ نظام الري</div>
<div class="box">
<select id="irrigationType" onchange="changeIrrigation()">
<option value="">اختر</option>
<option value="sprinkler">رشاش</option>
<option value="drip">تنقيط</option>
<option value="flood">غمر</option>
</select>

<div id="sprinkler" class="hidden">
<input placeholder="عدد الأبراج">
<input placeholder="طول البرج">
</div>

<div id="drip" class="hidden">
<input placeholder="طول التنقيط">
</div>

<div id="flood" class="hidden">
<input placeholder="المساحة">
<select>
<option>قمح</option>
<option>أعلاف خضراء</option>
<option>خضار</option>
<option>آخر</option>
</select>
</div>
</div>

<!-- 7 المزروعات -->
<div class="section">7️⃣ المزروعات</div>
<div class="box">
<select>
<option>نخيل</option>
<option>مصدات رياح</option>
<option>حمضيات</option>
<option>آخر</option>
</select>
<input placeholder="عدد الشتلات">
<div class="result">المساحة تحسب تلقائيًا</div>
</div>

<!-- 8 الموجودات -->
<div class="section">8️⃣ الموجودات</div>
<div class="box">
<div id="assets"></div>
<button class="btn-add" onclick="addAsset()">+ إضافة</button>
</div>

<script>
function addPoint(){
  let d=document.createElement('div');
  d.className='row';
  d.innerHTML=`
  <button class="btn-del" onclick="this.parentElement.remove()">-</button>
  <input class="lng" placeholder="Longitude">
  <input class="lat" placeholder="Latitude">`;
  points.appendChild(d);
}

function addWell(){
  let d=document.createElement('div');
  d.className='row';
  d.innerHTML=`
  <button class="btn-del" onclick="this.parentElement.remove()">-</button>
  <input placeholder="Longitude">
  <input placeholder="Latitude">`;
  wells.appendChild(d);
}

function addAsset(){
  let d=document.createElement('div');
  d.className='row';
  d.innerHTML=`
  <button class="btn-del" onclick="this.parentElement.remove()">-</button>
  <select>
    <option>مباني</option>
    <option>موجودات على البئر</option>
    <option>أخرى</option>
  </select>
  <input placeholder="الوصف">
  <input placeholder="العدد">`;
  assets.appendChild(d);
}

function changeIrrigation(){
  sprinkler.classList.add('hidden');
  drip.classList.add('hidden');
  flood.classList.add('hidden');
  document.getElementById(irrigationType.value)?.classList.remove('hidden');
}

function hav(lat1,lon1,lat2,lon2){
  const R=6371000;
  let dLat=(lat2-lat1)*Math.PI/180;
  let dLon=(lon2-lon1)*Math.PI/180;
  let a=Math.sin(dLat/2)**2+
  Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return 2*R*Math.asin(Math.sqrt(a));
}

function calcArea(){
  let pts=[...document.querySelectorAll('.lng')].map((e,i)=>({
    lng:+e.value,lat:+document.querySelectorAll('.lat')[i].value
  }));
  if(pts.length<3)return;
  let sum=0;
  for(let i=0;i<pts.length;i++){
    let j=(i+1)%pts.length;
    sum+=pts[i].lng*pts[j].lat-pts[j].lng*pts[i].lat;
  }
  let area=Math.abs(sum/2)*111139*111139;
  areaResult.innerHTML=
  `المساحة: ${area.toFixed(2)} م² | ${(area/10000).toFixed(2)} هكتار | ${(area/1000).toFixed(2)} دونم`;
}

addPoint();addPoint();addPoint();addPoint();
</script>

</body>
</html>