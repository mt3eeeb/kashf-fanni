<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>المزروعات</title>
<style>
  body { font-family: Arial; direction: rtl; padding: 15px; }
  .box { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  input, select, button { margin: 3px; }
</style>
</head>
<body>

<h3>المزروعات</h3>

<div id="cropsContainer"></div>

<button onclick="addCrop()">+ إضافة مزروع</button>

<script>
/* ===== بند 7 : المزروعات ===== */

let crops = [];

// تحميل
document.addEventListener("DOMContentLoaded", () => {
  crops = JSON.parse(localStorage.getItem("crops")) || [];
  renderCrops();
});

// حفظ
function saveCrops() {
  localStorage.setItem("crops", JSON.stringify(crops));
}

// إضافة
function addCrop() {
  crops.push({
    type: "",
    customType: "",
    count: "",
    areaM: "",
    areaH: "",
    areaD: ""
  });
  saveCrops();
  renderCrops();
}

// حذف
function removeCrop(i) {
  crops.splice(i, 1);
  saveCrops();
  renderCrops();
}

// تحديث
function updateCrop(i, field, val) {
  crops[i][field] = val;
  saveCrops();
  renderCrops();
}

// عرض
function renderCrops() {
  const c = document.getElementById("cropsContainer");
  c.innerHTML = "";

  crops.forEach((r, i) => {
    c.innerHTML += `
      <div class="box">

        نوع المزروع:
        <select onchange="updateCrop(${i},'type',this.value)">
          <option value="">—</option>
          <option ${r.type=="قمح"?"selected":""}>قمح</option>
          <option ${r.type=="نخيل"?"selected":""}>نخيل</option>
          <option ${r.type=="أعلاف"?"selected":""}>أعلاف</option>
          <option ${r.type=="خضار"?"selected":""}>خضار</option>
          <option ${r.type=="آخر"?"selected":""}>آخر</option>
        </select>

        ${r.type=="آخر" ? `
          <br>
          نوع آخر:
          <input placeholder="اكتب النوع"
            value="${r.customType}"
            oninput="updateCrop(${i},'customType',this.value)">
        ` : ""}

        <br>
        عدد الشتلات:
        <input type="number" value="${r.count}"
          oninput="updateCrop(${i},'count',this.value)">

        <hr>
        المساحة (كتابي):

        <br>
        م²:
        <input type="number" value="${r.areaM}"
          oninput="updateCrop(${i},'areaM',this.value)">

        هكتار:
        <input type="number" step="any" value="${r.areaH}"
          oninput="updateCrop(${i},'areaH',this.value)">

        دونم:
        <input type="number" step="any" value="${r.areaD}"
          oninput="updateCrop(${i},'areaD',this.value)">

        <br><br>
        <button onclick="removeCrop(${i})">− حذف</button>
      </div>
    `;
  });
}
</script>

</body>
</html>