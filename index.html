<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>بند 7 - المزروعات</title>
<style>
  body { font-family: Arial; direction: rtl; padding: 15px; }
  .box {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 10px;
    background: #fafafa;
  }
  input, select, button {
    margin: 4px;
    padding: 4px;
  }
</style>
</head>
<body>

<h3>المزروعات</h3>

<div id="cropsContainer"></div>

<button onclick="addCrop()">+ إضافة مزروع</button>

<script>
/* ===== بند 7 : المزروعات ===== */

let crops = [];

// تحميل البيانات
document.addEventListener("DOMContentLoaded", () => {
  crops = JSON.parse(localStorage.getItem("crops")) || [];
  renderCrops();
});

// حفظ
function saveCrops() {
  localStorage.setItem("crops", JSON.stringify(crops));
}

// إضافة
function addCrop() {
  crops.push({
    type: "",
    otherType: "",
    count: ""
  });
  saveCrops();
  renderCrops();
}

// حذف
function removeCrop(i) {
  crops.splice(i, 1);
  saveCrops();
  renderCrops();
}

// تحديث
function updateCrop(i, field, val) {
  crops[i][field] = val;
  saveCrops();
  renderCrops();
}

// عرض
function renderCrops() {
  const c = document.getElementById("cropsContainer");
  c.innerHTML = "";

  crops.forEach((r, i) => {

    const count = Number(r.count) || 0;
    const areaM = count * 10; // 10 م² لكل شتلة
    const areaH = areaM / 10000;
    const areaD = areaM / 1000;

    c.innerHTML += `
      <div class="box">

        نوع المزروع:
        <select onchange="updateCrop(${i},'type',this.value)">
          <option value="">—</option>
          <option ${r.type=="نخيل"?"selected":""}>نخيل</option>
          <option ${r.type=="مصدات رياح"?"selected":""}>مصدات رياح</option>
          <option ${r.type=="حمضيات"?"selected":""}>حمضيات</option>
          <option ${r.type=="آخر"?"selected":""}>آخر</option>
        </select>

        ${r.type=="آخر" ? `
          <br>
          نوع آخر:
          <input
            placeholder="اكتب النوع"
            value="${r.otherType}"
            oninput="updateCrop(${i},'otherType',this.value)">
        ` : ""}

        <br>
        عدد الشتلات:
        <input type="number"
          value="${r.count}"
          oninput="updateCrop(${i},'count',this.value)">

        <hr>
        المساحة (حساب آلي):

        <br>
        ${areaM.toFixed(2)} م² |
        ${areaH.toFixed(4)} هكتار |
        ${areaD.toFixed(3)} دونم

        <br><br>
        <button onclick="removeCrop(${i})">− حذف</button>
      </div>
    `;
  });
}
</script>

</body>
</html>