<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>بند 6 - نظام الري</title>
<style>
  body { font-family: Arial; direction: rtl; padding:20px }
  input, select, button { margin:3px }
  .box { border:1px solid #ccc; padding:10px; margin-bottom:10px }
</style>
</head>

<body>

<h2>نظام الري</h2>

<div id="irrigationContainer"></div>

<button type="button" onclick="addIrrigation()">+ إضافة نظام ري</button>

<script>
/* ===== بند 6 : نظام الري ===== */

let irrigation = [];
const TOWER_LENGTH = 50; // طول البرج ثابت

// تحميل البيانات
window.onload = function(){
  const saved = localStorage.getItem("irrigation");
  irrigation = saved ? JSON.parse(saved) : [];
  renderIrrigation();
};

// حفظ
function saveIrrigation(){
  localStorage.setItem("irrigation", JSON.stringify(irrigation));
}

// إضافة
function addIrrigation(){
  irrigation.push({
    type:"",
    crop:"",
    fodder:"",
    towers:0
  });
  saveIrrigation();
  renderIrrigation();
}

// حذف
function removeIrrigation(i){
  irrigation.splice(i,1);
  saveIrrigation();
  renderIrrigation();
}

// تحديث
function updateIrrigation(i,f,v){
  irrigation[i][f] = v;
  saveIrrigation();
  renderIrrigation();
}

// حساب
function calc(t){
  const length = t * TOWER_LENGTH;
  const area = length * 50;
  return {
    length: length,
    m: area,
    h: (area/10000).toFixed(2),
    d: (area/1000).toFixed(2)
  };
}

// عرض
function renderIrrigation(){
  const c = document.getElementById("irrigationContainer");
  c.innerHTML = "";

  irrigation.forEach((r,i)=>{
    const a = calc(Number(r.towers));

    c.innerHTML += `
      <div class="box">

        نوع الري:
        <select onchange="updateIrrigation(${i},'type',this.value)">
          <option value="">—</option>
          <option ${r.type=="رشاش"?"selected":""}>رشاش</option>
          <option ${r.type=="تنقيط"?"selected":""}>تنقيط</option>
        </select>

        <br>

        المحصول:
        <select onchange="updateIrrigation(${i},'crop',this.value)">
          <option value="">—</option>
          <option ${r.crop=="قمح"?"selected":""}>قمح</option>
          <option ${r.crop=="أعلاف"?"selected":""}>أعلاف خضراء</option>
          <option ${r.crop=="آخر"?"selected":""}>آخر</option>
        </select>

        ${r.crop=="أعلاف" ? `
          <br>
          نوع الأعلاف:
          <input value="${r.fodder}"
            oninput="updateIrrigation(${i},'fodder',this.value)">
        ` : ""}

        <br>

        عدد الأبراج:
        <input type="number" min="0" value="${r.towers}"
          oninput="updateIrrigation(${i},'towers',this.value)">

        <button onclick="removeIrrigation(${i})">−</button>

        <hr>

        الطول الكلي: <b>${a.length}</b> م<br>
        المساحة: <b>${a.m}</b> م²<br>
        هكتار: <b>${a.h}</b><br>
        دونم: <b>${a.d}</b>

      </div>
    `;
  });
}
</script>

</body>
</html>