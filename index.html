<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>حساب حدود الأرض</title>

<style>
body {
  font-family: Tahoma, Arial;
  background:#f5f7f5;
  padding:15px;
}
h2 { color:#1b5e20; }
textarea {
  width:100%;
  height:140px;
  font-size:14px;
}
button {
  background:#2e7d32;
  color:white;
  border:none;
  padding:10px 15px;
  margin-top:10px;
  font-size:15px;
  border-radius:5px;
}
.result {
  margin-top:15px;
  background:#fff;
  padding:10px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<h2>حدود الأرض – حساب المساحة</h2>

<p>ألصق الإحداثيات (Latitude Longitude) كل نقطة بسطر:</p>

<textarea id="coords"></textarea>

<button onclick="calculate()">حساب المساحة</button>

<div class="result" id="output"></div>

<script>
const R = 6378137;

// تحويل درجات إلى راديان
function rad(d){ return d * Math.PI / 180; }

// إسقاط تقريبي إلى أمتار
function project(lat, lon, lat0){
  return {
    x: rad(lon) * R * Math.cos(rad(lat0)),
    y: rad(lat) * R
  };
}

// Shoelace
function polygonArea(points){
  let area = 0;
  for(let i=0;i<points.length;i++){
    let j = (i+1)%points.length;
    area += points[i].x * points[j].y;
    area -= points[j].x * points[i].y;
  }
  return Math.abs(area)/2;
}

// مسافة
function dist(a,b){
  return Math.hypot(b.x-a.x, b.y-a.y);
}

function calculate(){
  const lines = document.getElementById("coords").value.trim().split("\n");
  if(lines.length < 3){
    alert("أدخل 3 نقاط على الأقل");
    return;
  }

  let raw = [];
  for(let l of lines){
    let p = l.trim().split(/\s+/);
    if(p.length !== 2) continue;
    raw.push({lat:parseFloat(p[0]), lon:parseFloat(p[1])});
  }

  const lat0 = raw.reduce((s,p)=>s+p.lat,0)/raw.length;
  const pts = raw.map(p=>project(p.lat,p.lon,lat0));

  let html = "<b>أطوال الأضلاع:</b><br>";
  let per = 0;
  for(let i=0;i<pts.length;i++){
    let j=(i+1)%pts.length;
    let d = dist(pts[i],pts[j]);
    per += d;
    html += `P${i+1} → P${j+1}: ${d.toFixed(2)} م<br>`;
  }

  const area = polygonArea(pts);
  const dunum = area/1000;
  const hectare = area/10000;

  html += "<hr>";
  html += `<b>المساحة:</b><br>`;
  html += `${area.toFixed(2)} م²<br>`;
  html += `${dunum.toFixed(2)} دونم<br>`;
  html += `${hectare.toFixed(2)} هكتار`;

  document.getElementById("output").innerHTML = html;
}
</script>

</body>
</html>
