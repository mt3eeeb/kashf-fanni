<script>
/* ===== Ø¨Ù†Ø¯ 5: Ø§Ù„Ø¢Ø¨Ø§Ø± ===== */

let wells = [];

document.addEventListener("DOMContentLoaded", () => {
  wells = JSON.parse(localStorage.getItem("wells")) || [];
  renderWells();
});

// Ø­ÙØ¸
function saveWells() {
  localStorage.setItem("wells", JSON.stringify(wells));
}

// Ø¥Ø¶Ø§ÙØ© Ø¨Ø¦Ø±
function addWell() {
  wells.push({ lat: "", lng: "" });
  saveWells();
  renderWells();
}

// Ø­Ø°Ù Ø¨Ø¦Ø±
function removeWell(index) {
  wells.splice(index, 1);
  saveWells();
  renderWells();
}

// ØªØ­Ø¯ÙŠØ«
function updateWell(index, field, value) {
  wells[index][field] = value;
  saveWells();
}

// ÙØªØ­ Google Maps
function openWellMap(index) {
  const w = wells[index];
  if (!w.lat || !w.lng) {
    alert("Ø£Ø¯Ø®Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¨Ø¦Ø± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }
  window.open(
    "https://www.google.com/maps?q=" + w.lat + "," + w.lng,
    "_blank"
  );
}

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
function locateWell(index) {
  if (!navigator.geolocation) {
    alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    wells[index].lat = pos.coords.latitude.toFixed(6);
    wells[index].lng = pos.coords.longitude.toFixed(6);
    saveWells();
    renderWells();
  });
}

// Ø¹Ø±Ø¶
function renderWells() {
  const c = document.getElementById("wellsContainer");
  if (!c) return;

  c.innerHTML = "";

  wells.forEach((w, i) => {
    c.innerHTML += `
      <div style="margin-bottom:8px">
        Lat:
        <input type="number" step="any" value="${w.lat}"
          oninput="updateWell(${i}, 'lat', this.value)">
        Lng:
        <input type="number" step="any" value="${w.lng}"
          oninput="updateWell(${i}, 'lng', this.value)">
        <button onclick="locateWell(${i})">ğŸ“</button>
        <button onclick="openWellMap(${i})">ğŸ—ºï¸</button>
        <button onclick="removeWell(${i})">âˆ’</button>
      </div>
    `;
  });
}
</script>