<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ÙƒØ´Ù ÙÙ†ÙŠ Ø²Ø±Ø§Ø¹ÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;direction:rtl;background:#f5f5f5;margin:0}
.section{background:#2ecc71;color:#fff;padding:10px;font-weight:bold}
.box{background:#fff;padding:10px;margin-bottom:10px}
input,select,button{width:100%;padding:6px;margin:4px 0}
.row{display:flex;gap:5px}
.row input{flex:1}
.btn{background:#27ae60;color:#fff;border:0;padding:8px}
.btn-red{background:#e74c3c}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<div class="section">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
<div class="box">
<input placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<input placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
<input type="date">
</div>

<!-- Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© -->
<div class="section">Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</div>
<div class="box" id="points">
</div>
<button class="btn" onclick="addPoint()">+ Ø¥Ø¶Ø§ÙØ© Ø²Ø§ÙˆÙŠØ©</button>

<br>

<button class="btn" onclick="openMaps()">ÙØªØ­ Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨</button>
<button class="btn" onclick="openDalilah()">ÙØªØ­ Ø§Ù„Ø¯Ù„ÙŠÙ„Ø©</button>

<br><br>

<button class="btn" onclick="calcDistances()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø·ÙˆØ§Ù„ ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©</button>

<div class="box" id="results"></div>

<!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠ -->
<div class="section">Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠ</div>
<div class="box">
<select id="irrigation">
<option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø±ÙŠ</option>
<option>Ø±Ø´ Ù…Ø­ÙˆØ±ÙŠ</option>
<option>ØªÙ†Ù‚ÙŠØ·</option>
<option>ØºÙ…Ø±</option>
</select>

<div id="pivotBox" style="display:none">
<input type="number" id="towers" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬">
<div class="small">Ø·ÙˆÙ„ Ø§Ù„Ø¨Ø±Ø¬ Ø«Ø§Ø¨Øª = 50 Ù…</div>
</div>

<select>
<option>Ù‚Ù…Ø­</option>
<option>Ø£Ø¹Ù„Ø§Ù Ø®Ø¶Ø±Ø§Ø¡</option>
<option>Ø£Ø®Ø±Ù‰</option>
</select>

<button class="btn" onclick="calcPivot()">Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ø¬</button>

<div class="box" id="pivotResult"></div>
</div>

<!-- Ø§Ù„Ù…Ø²Ø±ÙˆØ¹Ø§Øª -->
<div class="section">Ø§Ù„Ù…Ø²Ø±ÙˆØ¹Ø§Øª</div>
<div class="box" id="plants"></div>
<button class="btn" onclick="addPlant()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø²Ø±ÙˆØ¹</button>

<br><br>

<button class="btn" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸</button>
<button class="btn btn-red" onclick="clearData()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>

<script>
/* Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
window.onload=()=>{loadData();addPoint();addPlant()}

function addPoint(lat='',lng=''){
let d=document.createElement('div')
d.className='row'
d.innerHTML=`<input placeholder="Longitude" value="${lng}">
<input placeholder="Latitude" value="${lat}">`
document.getElementById('points').appendChild(d)
}

function addPlant(){
let d=document.createElement('div')
d.innerHTML=`
<select>
<option>Ù†Ø®ÙŠÙ„</option>
<option>Ù…ØµØ¯Ø§Øª Ø±ÙŠØ§Ø­</option>
<option>Ø­Ù…Ø¶ÙŠØ§Øª</option>
<option>Ø£Ø®Ø±Ù‰</option>
</select>
<input placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
<input placeholder="Ø§Ù„Ù†ÙˆØ¹">
<hr>`
document.getElementById('plants').appendChild(d)
}

document.getElementById('irrigation').onchange=e=>{
document.getElementById('pivotBox').style.display=
e.target.value==='Ø±Ø´ Ù…Ø­ÙˆØ±ÙŠ'?'block':'none'
}

function calcPivot(){
let n=+document.getElementById('towers').value
if(!n)return
let r=n*50
let area=Math.PI*r*r
document.getElementById('pivotResult').innerHTML=
`Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Â²: ${area.toFixed(1)}<br>
Ù‡ÙƒØªØ§Ø±: ${(area/10000).toFixed(2)}<br>
Ø¯ÙˆÙ†Ù…: ${(area/1000).toFixed(1)}`
}

function calcDistances(){
let pts=[...document.querySelectorAll('#points .row')]
.map(r=>({
lng:+r.children[0].value,
lat:+r.children[1].value
}))
if(pts.length<3)return
let res=''
let area=0
for(let i=0;i<pts.length;i++){
let j=(i+1)%pts.length
let dx=(pts[j].lng-pts[i].lng)*111000
let dy=(pts[j].lat-pts[i].lat)*111000
let d=Math.sqrt(dx*dx+dy*dy)
res+=`Ø§Ù„Ù…Ø³Ø§ÙØ© ${i+1}-${j+1}: ${d.toFixed(1)} Ù…<br>`
area+=pts[i].lng*pts[j].lat-pts[j].lng*pts[i].lat
}
area=Math.abs(area)/2*111000*111000
res+=`<hr>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Â²: ${area.toFixed(1)}
<br>Ù‡ÙƒØªØ§Ø±: ${(area/10000).toFixed(2)}
<br>Ø¯ÙˆÙ†Ù…: ${(area/1000).toFixed(1)}`
document.getElementById('results').innerHTML=res
}

function openMaps(){
let r=document.querySelector('#points .row')
if(!r)return
window.open(`https://maps.google.com/?q=${r.children[1].value},${r.children[0].value}`)
}

function openDalilah(){
let r=document.querySelector('#points .row')
if(!r)return
window.location=`dalilah://?lat=${r.children[1].value}&lng=${r.children[0].value}`
}

/* Ø­ÙØ¸ */
function saveData(){
localStorage.setItem('form',document.body.innerHTML)
alert('ØªÙ… Ø§Ù„Ø­ÙØ¸')
}
function loadData(){
let d=localStorage.getItem('form')
if(d)document.body.innerHTML=d
}
function clearData(){
localStorage.clear()
location.reload()
}
</script>

</body>
</html>