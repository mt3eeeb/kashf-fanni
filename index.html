<script>
/* ===== Ø¨Ù†Ø¯ 5: Ø§Ù„Ø¢Ø¨Ø§Ø± ===== */

let wells = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
document.addEventListener("DOMContentLoaded", function () {
  const saved = localStorage.getItem("wells");
  wells = saved ? JSON.parse(saved) : [];
  renderWells();
});

// Ø­ÙØ¸
function saveWells() {
  localStorage.setItem("wells", JSON.stringify(wells));
}

// Ø¥Ø¶Ø§ÙØ© Ø¨Ø¦Ø±
function addWell() {
  wells.push({ lat: "", lng: "" });
  saveWells();
  renderWells();
}

// Ø­Ø°Ù Ø¨Ø¦Ø±
function removeWell(index) {
  wells.splice(index, 1);
  saveWells();
  renderWells();
}

// ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø©
function updateWell(index, field, value) {
  wells[index][field] = value;
  saveWells();
}

// ÙØªØ­ Google Maps
function openWellMap(index) {
  const w = wells[index];
  if (!w.lat || !w.lng) {
    alert("Ø£Ø¯Ø®Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¨Ø¦Ø± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }
  window.open(
    "https://www.google.com/maps?q=" + w.lat + "," + w.lng,
    "_blank"
  );
}

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
function locateWell(index) {
  if (!navigator.geolocation) {
    alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function (pos) {
      wells[index].lat = pos.coords.latitude.toFixed(6);
      wells[index].lng = pos.coords.longitude.toFixed(6);
      saveWells();
      renderWells();
    },
    function () {
      alert("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    }
  );
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ø¨Ø§Ø±
function renderWells() {
  const container = document.getElementById("wellsContainer");
  if (!container) return;

  container.innerHTML = "";

  wells.forEach(function (w, i) {
    const div = document.createElement("div");
    div.style.marginBottom = "8px";

    div.innerHTML = `
      Lat:
      <input type="number" step="any" value="${w.lat}"
        oninput="updateWell(${i}, 'lat', this.value)">
      Lng:
      <input type="number" step="any" value="${w.lng}"
        oninput="updateWell(${i}, 'lng', this.value)">
      <button type="button" onclick="locateWell(${i})">ğŸ“</button>
      <button type="button" onclick="openWellMap(${i})">ğŸ—ºï¸</button>
      <button type="button" onclick="removeWell(${i})">âˆ’</button>
    `;

    container.appendChild(div);
  });
}
</script>