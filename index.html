<!-- ===== 4- Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø±Ø¶ ===== -->
<h3>4- Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø±Ø¶</h3>

<div id="points-container">
  <div class="point">
    <input type="number" step="any" placeholder="Latitude">
    <input type="number" step="any" placeholder="Longitude">
  </div>
  <div class="point">
    <input type="number" step="any" placeholder="Latitude">
    <input type="number" step="any" placeholder="Longitude">
  </div>
  <div class="point">
    <input type="number" step="any" placeholder="Latitude">
    <input type="number" step="any" placeholder="Longitude">
  </div>
</div>

<button onclick="addPoint()">â• Ø¥Ø¶Ø§ÙØ© Ø²Ø§ÙˆÙŠØ©</button>
<button onclick="calcArea()">ğŸ“ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</button>

<div id="result"></div>

<script>
function addPoint(){
  const d=document.createElement('div');
  d.className='point';
  d.innerHTML=`
    <input type="number" step="any" placeholder="Latitude">
    <input type="number" step="any" placeholder="Longitude">
  `;
  document.getElementById('points-container').appendChild(d);
}

/* ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ² */
function sortClockwise(pts){
  let cx=0,cy=0;
  pts.forEach(p=>{cx+=p.x;cy+=p.y;});
  cx/=pts.length; cy/=pts.length;
  return pts.sort((a,b)=>
    Math.atan2(a.y-cy,a.x-cx)-Math.atan2(b.y-cy,b.x-cx)
  );
}

/* ØªØ­ÙˆÙŠÙ„ WGS84 Ø¥Ù„Ù‰ Ù…ØªØ± (Ø«Ø§Ø¨Øª Ù„Ù„Ø¬ÙˆØ§Ù„) */
function project(lat,lon){
  const R=6378137;
  return {
    x:R*lon*Math.PI/180,
    y:R*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360))
  };
}

/* Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
function calcArea(){
  const rows=document.querySelectorAll('.point');
  let pts=[];

  rows.forEach(r=>{
    const lat=parseFloat(r.children[0].value);
    const lon=parseFloat(r.children[1].value);
    if(!isNaN(lat)&&!isNaN(lon)){
      const p=project(lat,lon);
      pts.push(p);
    }
  });

  if(pts.length<3){
    alert('Ø£Ø¯Ø®Ù„ 3 Ø²ÙˆØ§ÙŠØ§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    return;
  }

  pts=sortClockwise(pts);

  let area=0;
  for(let i=0;i<pts.length;i++){
    const j=(i+1)%pts.length;
    area+=pts[i].x*pts[j].y-pts[j].x*pts[i].y;
  }
  area=Math.abs(area)/2;

  document.getElementById('result').innerHTML=`
    <h4>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</h4>
    ${area.toFixed(2)} Ù…Â²<br>
    ${(area/1000).toFixed(2)} Ø¯ÙˆÙ†Ù…<br>
    ${(area/10000).toFixed(2)} Ù‡ÙƒØªØ§Ø±
  `;
}
</script>
