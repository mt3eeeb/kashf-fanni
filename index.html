<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ÙƒØ´Ù ÙÙ†ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ - ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©</title>
    <style>
        :root { --main-green: #2e7d32; --light-green: #e8f5e9; }
        body { font-family: 'Tahoma', 'Arial', sans-serif; background: #f2f5f3; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        .header { text-align: center; margin-bottom: 25px; border: 2px solid var(--main-green); padding: 15px; border-radius: 6px; }
        .header h1 { margin: 0; font-size: 22px; color: var(--main-green); }
        .header h2 { margin: 5px 0 0; font-size: 16px; color: var(--main-green); }

        .section { background: #fff; border-radius: 6px; margin-bottom: 20px; border: 1px solid var(--main-green); overflow: hidden; }
        .section-title { background: var(--light-green); color: var(--main-green); padding: 10px 15px; font-size: 15px; font-weight: bold; border-bottom: 1px solid var(--main-green); }
        .section-body { padding: 15px; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ */
        .row { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 10px; }
        .field { flex: 1; min-width: 120px; }
        label { font-size: 13px; display: block; margin-bottom: 5px; color: var(--main-green); font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶Ù‡Ø§ */
        .coords-row { display: flex; gap: 10px; align-items: flex-end; background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 10px; border: 1px dashed #ccc; }
        .coords-row .field { flex: 1; }

        button { padding: 8px 15px; font-size: 13px; cursor: pointer; background: var(--main-green); color: #fff; border: none; border-radius: 4px; transition: 0.3s; margin: 5px 2px; }
        button:hover { background: #1b5e20; }
        button.btn-remove { background: #d32f2f; }
        
        #result { background: #f1f8e9; padding: 10px; border-radius: 4px; margin-top: 10px; border: 1px solid var(--main-green); }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body { background: #fff; padding: 0; }
            .container { box-shadow: none; max-width: 100%; width: 100%; }
            button { display: none !important; }
            .section { border: 1px solid #000; page-break-inside: avoid; }
            .page-break { page-break-before: always; } /* ÙØ§ØµÙ„ Ø§Ù„ØµÙØ­Ø§Øª */
            input, select { border: none; background: transparent; appearance: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©</h1>
        <h2>Ù…ÙƒØªØ¨ Ù…Ø­Ø§ÙØ¸Ø© Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
        <h2>ÙƒØ´Ù ÙÙ†ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ</h2>
    </div>

    <!-- 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <div class="section">
        <div class="section-title">1ï¸âƒ£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
        <div class="section-body">
            <div class="row">
                <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="text"></div>
                <div class="field"><label>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</label><input type="text"></div>
                <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label><input type="date"></div>
            </div>
        </div>
    </div>

    <!-- 2. Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø³Ø¬Ù„ -->
    <div class="section">
        <div class="section-title">2ï¸âƒ£ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø³Ø¬Ù„</div>
        <div class="section-body">
            <div class="coords-row">
                <div class="field"><label>Latitude</label><input type="text" id="recordLat"></div>
                <div class="field"><label>Longitude</label><input type="text" id="recordLng"></div>
            </div>
            <button onclick="openMap('recordLat', 'recordLng')">ğŸ“ Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
        </div>
    </div>

    <!-- 3. Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© -->
    <div class="section">
        <div class="section-title">3ï¸âƒ£ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©</div>
        <div class="section-body">
            <div class="coords-row">
                <div class="field"><label>Latitude</label><input type="text" id="gateLat"></div>
                <div class="field"><label>Longitude</label><input type="text" id="gateLng"></div>
            </div>
            <button onclick="getGateLocation()">ğŸ§­ Ø¬Ù„Ø¨ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
            <button onclick="openMap('gateLat', 'gateLng')">ğŸ“ Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
        </div>
    </div>

    <!-- 4. Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø±Ø¶ -->
    <div class="section">
        <div class="section-title">4ï¸âƒ£ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</div>
        <div class="section-body">
            <div id="points-container">
                <!-- Ø§Ù„Ù†Ù‚Ø§Ø· Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            <button onclick="addPoint()">+ Ø¥Ø¶Ø§ÙØ© Ø²Ø§ÙˆÙŠØ©</button>
            <button onclick="calculateArea()" style="background: #2196F3;">âš–ï¸ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø·ÙˆØ§Ù„ ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©</button>
            <div id="result">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
        </div>
    </div>

    <!-- ÙØ§ØµÙ„ ØµÙØ­Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="page-break"></div>

    <!-- 5. Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¢Ø¨Ø§Ø± -->
    <div class="section">
        <div class="section-title">5ï¸âƒ£ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¢Ø¨Ø§Ø±</div>
        <div class="section-body">
            <div id="wells-container"></div>
            <button onclick="addWell()">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø¦Ø± Ø¬Ø¯ÙŠØ¯</button>
        </div>
    </div>

    <!-- 6. Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠ -->
    <div class="section">
        <div class="section-title">6ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠ</div>
        <div class="section-body" id="irrigationContainer">
            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ -->
        </div>
        <button onclick="addIrrigation()" style="margin: 15px;">â• Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø±ÙŠ</button>
    </div>

    <!-- 9. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø« -->
    <div class="section">
        <div class="section-title">9ï¸âƒ£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø« ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</div>
        <div class="section-body">
            <div class="field">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø« Ø§Ù„ÙÙ†ÙŠ</label>
                <input type="text" id="researcherName">
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="window.print()" style="background: #000; padding: 10px 30px;">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒØ´Ù (PDF)</button>
                <button onclick="location.reload()" class="btn-remove">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ---
    function openMap(latId, lngId) {
        const lat = document.getElementById(latId).value;
        const lng = document.getElementById(lngId).value;
        if(lat && lng) window.open(`https://www.google.com/maps?q=${lat},${lng}`, '_blank');
        else alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª");
    }

    function getGateLocation() {
        navigator.geolocation.getCurrentPosition(pos => {
            document.getElementById('gateLat').value = pos.coords.latitude.toFixed(6);
            document.getElementById('gateLng').value = pos.coords.longitude.toFixed(6);
        }, () => alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹"));
    }

    // --- Ø¨Ù†Ø¯ 4: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© ---
    function addPoint(lat = '', lon = '') {
        const container = document.getElementById('points-container');
        const div = document.createElement('div');
        div.className = 'coords-row';
        div.innerHTML = `
            <div class="field"><label>Latitude</label><input type="number" step="any" class="lat" value="${lat}"></div>
            <div class="field"><label>Longitude</label><input type="number" step="any" class="lon" value="${lon}"></div>
            <button class="btn-remove" onclick="this.parentElement.remove()">Ã—</button>
        `;
        container.appendChild(div);
    }

    function calculateArea() {
        const R = 6378137; 
        const lats = document.querySelectorAll('.lat');
        const lons = document.querySelectorAll('.lon');
        let points = [];
        
        if(lats.length < 3) { alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© 3 Ø²ÙˆØ§ÙŠØ§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }

        const lat0 = parseFloat(lats[0].value);
        const lon0 = parseFloat(lons[0].value);

        for (let i = 0; i < lats.length; i++) {
            let y = (parseFloat(lats[i].value) - lat0) * (Math.PI / 180) * R;
            let x = (parseFloat(lons[i].value) - lon0) * (Math.PI / 180) * R * Math.cos(lat0 * Math.PI / 180);
            points.push({x, y});
        }

        let area = 0;
        let perimeter = 0;
        for (let i = 0; i < points.length; i++) {
            let j = (i + 1) % points.length;
            area += points[i].x * points[j].y - points[j].x * points[i].y;
            perimeter += Math.hypot(points[j].x - points[i].x, points[j].y - points[i].y);
        }
        area = Math.abs(area / 2);

        document.getElementById('result').innerHTML = `
            <strong>Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</strong><br>
            Ø§Ù„Ù…Ø­ÙŠØ·: ${perimeter.toFixed(2)} Ù… <br>
            Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${area.toFixed(2)} Ù…Â² <br>
            Ø§Ù„Ù‡ÙƒØªØ§Ø±: ${(area/10000).toFixed(2)} Ù‡Ù€ | Ø§Ù„Ø¯ÙˆÙ†Ù…: ${(area/1000).toFixed(2)} Ø¯ÙˆÙ†Ù…
        `;
    }

    // --- Ø¨Ù†Ø¯ 5: Ø§Ù„Ø¢Ø¨Ø§Ø± ---
    function addWell() {
        const container = document.getElementById('wells-container');
        const div = document.createElement('div');
        div.className = 'coords-row';
        div.innerHTML = `
            <div class="field"><label>Ø¨Ø¦Ø± (Lat)</label><input type="number" step="any" class="w-lat"></div>
            <div class="field"><label>Ø¨Ø¦Ø± (Lng)</label><input type="number" step="any" class="w-lon"></div>
            <button class="btn-remove" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
        `;
        container.appendChild(div);
    }

    // --- Ø¨Ù†Ø¯ 6: Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙŠ (Ù…Ø¨Ø³Ø·) ---
    function addIrrigation() {
        const container = document.getElementById('irrigationContainer');
        const div = document.createElement('div');
        div.style = "border:1px solid #ddd; padding:10px; margin-bottom:10px; border-radius:4px;";
        div.innerHTML = `
            <div class="row">
                <div class="field"><label>Ù†ÙˆØ¹ Ø§Ù„Ø±ÙŠ</label><select><option>Ø±Ø´Ø§Ø´ Ù…Ø­ÙˆØ±ÙŠ</option><option>ØªÙ†Ù‚ÙŠØ·</option><option>ØºÙ…Ø±</option></select></div>
                <div class="field"><label>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</label><input type="number" placeholder="Ù…Â²"></div>
                <button class="btn-remove" onclick="this.parentElement.parentElement.remove()">Ã—</button>
            </div>
        `;
        container.appendChild(div);
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ù‚Ø§Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    window.onload = () => {
        addPoint('27.906706', '47.657379');
        addPoint('27.895394', '47.630944');
        addPoint('27.875918', '47.644017');
        addIrrigation();
    };
</script>

</body>
</html>
