<section>
<h3>4- Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø±Ø¶</h3>

<table id="coords">
<tr><th>#</th><th>Latitude</th><th>Longitude</th></tr>

<tr>
<td>1</td>
<td><input type="number" step="any"></td>
<td><input type="number" step="any"></td>
</tr>
<tr>
<td>2</td>
<td><input type="number" step="any"></td>
<td><input type="number" step="any"></td>
</tr>
<tr>
<td>3</td>
<td><input type="number" step="any"></td>
<td><input type="number" step="any"></td>
</tr>
<tr>
<td>4</td>
<td><input type="number" step="any"></td>
<td><input type="number" step="any"></td>
</tr>
</table>

<br>
<button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ø²Ø§ÙˆÙŠØ©</button>
<button onclick="calc()">ğŸ“ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</button>

<div id="out"></div>
</section>

<script>
const R = 6378137;

function addRow(){
  const t = document.getElementById("coords");
  const r = t.insertRow();
  r.innerHTML = `
    <td>${t.rows.length-1}</td>
    <td><input type="number" step="any"></td>
    <td><input type="number" step="any"></td>
  `;
}

function rad(d){ return d*Math.PI/180; }

// Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† (ØµØ­)
function dist(a,b){
  const dLat = rad(b.lat-a.lat);
  const dLon = rad(b.lon-a.lon);
  const x = Math.sin(dLat/2)**2 +
            Math.cos(rad(a.lat))*Math.cos(rad(b.lat))*
            Math.sin(dLon/2)**2;
  return 2*R*Math.asin(Math.sqrt(x));
}

// Ø¥Ø³Ù‚Ø§Ø· Ù…Ø­Ù„ÙŠ Ø«Ø§Ø¨Øª
function project(p, ref){
  const x = rad(p.lon-ref.lon)*R*Math.cos(rad(ref.lat));
  const y = rad(p.lat-ref.lat)*R;
  return {x,y};
}

function polygonArea(pts){
  let a=0;
  for(let i=0;i<pts.length;i++){
    const j=(i+1)%pts.length;
    a+=pts[i].x*pts[j].y-pts[j].x*pts[i].y;
  }
  return Math.abs(a/2);
}

function calc(){
  const rows=[...document.querySelectorAll("#coords tr")].slice(1);
  let pts=[];

  rows.forEach(r=>{
    const lat=parseFloat(r.cells[1].children[0].value);
    const lon=parseFloat(r.cells[2].children[0].value);
    if(!isNaN(lat)&&!isNaN(lon)) pts.push({lat,lon});
  });

  if(pts.length<3){ alert("Ø£Ø¯Ø®Ù„ 3 Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }

  let lengths="";
  for(let i=0;i<pts.length;i++){
    const j=(i+1)%pts.length;
    lengths+=`P${i+1} â†’ P${j+1}: ${dist(pts[i],pts[j]).toFixed(2)} Ù…<br>`;
  }

  const ref=pts[0];
  const proj=pts.map(p=>project(p,ref));
  const area=polygonArea(proj);

  document.getElementById("out").innerHTML=`
  <h4>Ø£Ø·ÙˆØ§Ù„ Ø§Ù„Ø£Ø¶Ù„Ø§Ø¹:</h4>${lengths}
  <h4>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</h4>
  ${area.toFixed(2)} Ù…Â²<br>
  ${(area/1000).toFixed(2)} Ø¯ÙˆÙ†Ù…<br>
  ${(area/10000).toFixed(2)} Ù‡ÙƒØªØ§Ø±
  `;
}
</script>
